F_params$flow_tempdorm_pptdorm<-mean_coeff$btempdormpptdorm_f
F_params$flow_tempgrow_pptgrow<-mean_coeff$btempgrowpptgrow_f
M_params$flow_mu <- mean_coeff$b0_f + mean_coeff$bsex_f
M_params$flow_size <- mean_coeff$bsize_f + mean_coeff$bsizesex_f
M_params$flow_pptgrow <- mean_coeff$bpptgrow_f  + mean_coeff$bpptgrowsex_f
M_params$flow_pptdorm <- mean_coeff$bpptdorm_f  + mean_coeff$bpptdormsex_f
M_params$flow_tempgrow <- mean_coeff$btempgrow_f + mean_coeff$btempgrowsex_f #
M_params$flow_tempdorm <-  mean_coeff$btempdorm_f  + mean_coeff$btempdormsex_f
M_params$flow_tempdorm_pptdorm<-mean_coeff$btempdormpptdorm_f + mean_coeff$btempdormpptdormsex_f
M_params$flow_tempgrow_pptgrow<-mean_coeff$btempgrowpptgrow_f + mean_coeff$btempgrowpptgrowsex_f
## panicles
F_params$panic_mu <- mean_coefp$b0_p
F_params$panic_size <- mean_coefp$bsize_p
F_params$panic_pptgrow <- mean_coefp$bpptgrow_p
F_params$panic_pptdorm <- mean_coefp$bpptdorm_p
F_params$panic_tempgrow <- mean_coefp$btempgrow_p
F_params$panic_tempdorm <- mean_coefp$btempdorm_p
F_params$panic_tempdorm_pptdorm<-mean_coefp$btempdormpptdorm_p
F_params$panic_tempgrow_pptgrow<-mean_coefp$btempgrowpptgrow_p
M_params$panic_mu <- mean_coefp$b0_p + mean_coefp$bsex_p
M_params$panic_size <- mean_coefp$bsize_p + mean_coefp$bsizesex_p
M_params$panic_pptgrow <- mean_coefp$bpptgrow_p  + mean_coefp$bpptgrowsex_p
M_params$panic_pptdorm <- mean_coefp$bpptdorm_p  + mean_coefp$bpptdormsex_p
M_params$panic_tempgrow <- mean_coefp$btempgrow_p + mean_coefp$btempgrowsex_p #
M_params$panic_tempdorm <-  mean_coefp$btempdorm_p  + mean_coefp$btempdormsex_p
M_params$panic_tempdorm_pptdorm<-mean_coefp$btempdormpptdorm_p + mean_coefp$btempdormpptdormsex_p
M_params$panic_tempgrow_pptgrow<-mean_coefp$btempgrowpptgrow_p + mean_coefp$btempgrowpptgrowsex_p
## seed viability and misc fertility params
F_params$v0 <- mean_coefv$v0
F_params$a_v <- mean_coefv$a_v
F_params$ov_per_inf <- mean_coefv$lambda_d
F_params$germ <- mean_coefv$m
F_params$PSR <- 0.5
## use POAU seedling survival for females and males
F_params$sdlg_surv <- M_params$sdlg_surv <- sdlg_surv$sdlg_surv
## set max size equal between the sexes
F_params$max_size <- M_params$max_size <- round(quantile(na.omit((poar.clim_seasonal$tillerN_t1)),probs=0.99))
poar.clim_seasonal %>%
subset( tillerN_t0 > 0 & tillerN_t1 > 0)%>%
mutate( site         = site %>% as.factor %>% as.numeric,
Block = Block %>% as.factor %>% as.numeric,
Sex          = Sex %>% as.factor %>% as.numeric,
source = Code %>% as.factor %>% as.numeric ) %>%
group_by(site) %>%
summarise( Longitude=unique(Longitude),
Latitude=unique(Latitude),
size = mean(tillerN_t1),
pptgrow= mean(pptgrow),
temprow= mean(tempgrow),
pptdorm= mean(pptdorm),
tempdorm= mean(tempdorm))->poarclim_seasonal.mean
climmean<- data.frame(mean_size=rep(mean(poarclim_seasonal.mean$size),nrow(poarclim_seasonal.mean)),mean_pptgrow=rep(mean(poarclim_seasonal.mean$pptgrow),nrow(poarclim_seasonal.mean)),mean_temprow=rep(mean(poarclim_seasonal.mean$temprow),nrow(poarclim_seasonal.mean)),mean_pptdorm=rep(mean(poarclim_seasonal.mean$pptdorm),nrow(poarclim_seasonal.mean)),mean_tempdorm=rep(mean(poarclim_seasonal.mean$tempdorm),nrow(poarclim_seasonal.mean)))
poarclim_seasonal.meanplot<-data.frame(poarclim_seasonal.mean,climmean)
# poarclim_seasonal.mean<-as.data.frame(poarclim_seasonal.mean)
## evaluate lambda at mean climate
## female-dominant:
max_yrs<-10
Fdom_meanclim_mat <- megamatrix_delay(F_params=F_params,
M_params=M_params,
twosex=F,
grow_perturb=0,
surv_perturb=0,
flow_perturb=0,
fert_perturb=0,
viab_perturb=0,
pptgrow=mean(poarclim_seasonal.mean$mean_pptgrow),
tempgrow=mean(poarclim_seasonal.mean$mean_temprow),
pptdorm=mean(poarclim_seasonal.mean$mean_pptdorm),
tempdorm=mean(poarclim_seasonal.mean$mean_tempdorm),
rfx=rfx_fun())
popbio::lambda(Fdom_meanclim_mat$MEGAmat) ## this is unrealistically high
## evaluate lambda at mean climate
## female-dominant:
max_yrs<-10
Fdom_meanclim_mat <- megamatrix_delay(F_params=F_params,
M_params=M_params,
twosex=F,
grow_perturb=0,
surv_perturb=0,
flow_perturb=0,
fert_perturb=0,
viab_perturb=0,
pptgrow=mean(poarclim_seasonal.mean$mean_pptgrow),
tempgrow=mean(poarclim_seasonal.mean$mean_temprow),
pptdorm=mean(poarclim_seasonal.mean$mean_pptdorm),
tempdorm=mean(poarclim_seasonal.mean$mean_tempdorm),
rfx=rfx_fun())
Fdom_meanclim_mat <- megamatrix_delay(F_params=F_params,
M_params=M_params,
twosex=F,
grow_perturb=0,
surv_perturb=0,
flow_perturb=0,
fert_perturb=0,
viab_perturb=0,
pptgrow=mean(poarclim_seasonal.mean$pptgrow),
tempgrow=mean(poarclim_seasonal.mean$temprow),
pptdorm=mean(poarclim_seasonal.mean$pptdorm),
tempdorm=mean(poarclim_seasonal.mean$tempdorm),
rfx=rfx_fun())
popbio::lambda(Fdom_meanclim_mat$MEGAmat) ## this is unrealistically high
twosex_meanclim_mat <- lambdaSim_delay( F_params=F_params,
M_params=M_params,
grow_perturb=0,
surv_perturb=0,
flow_perturb=0,
fert_perturb=0,
viab_perturb=0,
pptgrow=mean(poarclim_seasonal.mean$pptgrow),
tempgrow=mean(poarclim_seasonal.mean$temprow),
pptdorm=mean(poarclim_seasonal.mean$pptdorm),
tempdorm=mean(poarclim_seasonal.mean$tempdorm),
max.yrs = max_yrs,
rfx = rfx_fun())
twosex_meanclim_mat$lambdatracker[max_yrs] # I am not sure about the lambdatracker values. Some at insanely high
lambda_growppt_mean<-lambda_growppt_mean_2sex<-SR_growppt_mean<-OSR_growppt_mean<-c()
ssdppt<-matrix(NA,(F_params$max_size+1)*2,nrow(poarclim_seasonal.meanplot))
for (i in 1:nrow(poarclim_seasonal.meanplot)){
#linear model for comparison
mat <- megamatrix_delay( F_params=F_params,
M_params=M_params,
twosex=F,
grow_perturb=0,
surv_perturb=0,
flow_perturb=0,
fert_perturb=0,
viab_perturb=0,
pptgrow=poarclim_seasonal.meanplot[i,5],
tempgrow=poarclim_seasonal.meanplot[i,11],
pptdorm=poarclim_seasonal.meanplot[i,12],
tempdorm=poarclim_seasonal.meanplot[i,13],
rfx=rfx_fun())$MEGAmat
lambda_growppt_mean[i] <- popbio::lambda(mat)
# 2-sex model
lambda_run <- lambdaSim_delay( F_params=F_params,
M_params=M_params,
grow_perturb=0,
surv_perturb=0,
flow_perturb=0,
fert_perturb=0,
viab_perturb=0,
pptgrow=poarclim_seasonal.meanplot[i,5],
tempgrow=poarclim_seasonal.meanplot[i,11],
pptdorm=poarclim_seasonal.meanplot[i,12],
tempdorm=poarclim_seasonal.meanplot[i,13],
rfx = rfx_fun(),
max.yrs = max_yrs)
lambda_growppt_mean_2sex[i] <- lambda_run$lambdatracker[max_yrs]
SR_growppt_mean[i] <- lambda_run$SRtracker[max_yrs]
OSR_growppt_mean[i] <- lambda_run$OSRtracker[max_yrs]
ssdppt[,i] <- lambda_run$n0
}
lambda_growppt_mean
lambda_growppt_mean_2sex
cbPalette <- RColorBrewer::brewer.pal(8, "Dark2")[c(2,1)]
par(mar=c(5,5,1,1))
plot(poarclim_seasonal.meanplot$pptgrow,lambda_growppt_mean,type="l",lwd=2,col=cbPalette[1],
xlab="Precipitation growing season",ylab=expression(paste(lambda)),cex.lab=1.5,ylim=c(0,2.7))
lines(poarclim_seasonal.meanplot$pptgrow,lambda_growppt_mean_2sex,type="l",lwd=2,col=cbPalette[2])
legend("topright",legend=c("Two-sex","Female-dominant"),lwd=2,col =cbPalette ,bty="n",cex=1.2)
poarclim_seasonal.meanplot
poarclim_seasonal.meanplot
lambda_grow_mean<-lambda_grow_mean_2sex<-SR_grow_mean<-OSR_grow_mean<-c()
ssd<-matrix(NA,(F_params$max_size+1)*2,nrow(poarclim_seasonal.meanplot))
max_yrs <- 10
for (i in 1:nrow(poarclim_seasonal.meanplot)){
#linear model for comparison
mat <- megamatrix_delay( F_params=F_params,
M_params=M_params,
twosex=F,
grow_perturb=0,
surv_perturb=0,
flow_perturb=0,
fert_perturb=0,
viab_perturb=0,
pptgrow=poarclim_seasonal.meanplot[i,5],
tempgrow=poarclim_seasonal.meanplot[i,6],
pptdorm=poarclim_seasonal.meanplot[i,12],
tempdorm=poarclim_seasonal.meanplot[i,13],
rfx=rfx_fun())$MEGAmat
lambda_grow_mean[i] <- popbio::lambda(mat)
# 2-sex model
lambda_run <- lambdaSim_delay( F_params=F_params,
M_params=M_params,
grow_perturb=0,
surv_perturb=0,
flow_perturb=0,
fert_perturb=0,
viab_perturb=0,
pptgrow=poarclim_seasonal.meanplot[i,5],
tempgrow=poarclim_seasonal.meanplot[i,6],
pptdorm=poarclim_seasonal.meanplot[i,12],
tempdorm=poarclim_seasonal.meanplot[i,13],
rfx = rfx_fun(),
max.yrs = max_yrs)
lambda_grow_mean_2sex[i] <- lambda_run$lambdatracker[max_yrs]
SR_grow_mean[i] <- lambda_run$SRtracker[max_yrs]
OSR_grow_mean[i] <- lambda_run$OSRtracker[max_yrs]
ssdppt[,i] <- lambda_run$n0
}
lambda_grow_mean_2sex
lambda_grow_mean
data_geo<-data.frame(long=poarclim_seasonal.meanplot$Longitude,lat=poarclim_seasonal.meanplot$Latitude,lambda=lambda_grow_mean)
data_geo
p <- ggplot() +
geom_polygon( data=data_geo,
aes(x=long, y=lat, group=group, fill = lambda),
color="white", size = 0.2)
p
p <- ggplot() +
geom_polygon( data=data_geo,
aes(x=long, y=lat, group=group, fill = lambda),
color="white", linewidth = 0.2)
p
p <- ggplot() +
geom_polygon( data=data_geo,
aes(x=long, y=lat, group=group),
color="white", linewidth = 0.2)
p
p <- ggplot() +
geom_polygon( data=data_geo,
aes(x=long, y=lat, fill = lambda),
color="white", linewidth = 0.2)
p
lambda
lambda_grow_mean
pptgrow_seq_extend <- seq(min(poar.clim_seasonal$pptgrow),max(poar.clim_seasonal$pptgrow),length.out=10)
tempgrow_seq_extend <- seq(min(poar.clim_seasonal$tempgrow),max(poar.clim_seasonal$tempgrow),length.out=10)
pptdorm_seq_extend <- seq(min(poar.clim_seasonal$pptdorm),max(poar.clim_seasonal$pptdorm),length.out=10)
tempdorm_seq_extend <- seq(min(poar.clim_seasonal$tempdorm),max(poar.clim_seasonal$tempdorm),length.out=10)
climat_grow<-expand.grid(pptgrow_seq_extend=pptgrow_seq_extend,tempgrow_seq_extend=tempgrow_seq_extend)
climat_grow
pptdorm_mean<-rep(mean(poar.clim_seasonal$pptdorm),nrow(climat_grow))
tempdorm_mean<-rep(mean(poar.clim_seasonal$tempdorm),nrow(climat_grow))
climat_grow<-data.frame(climat_grow,pptdorm_mean,tempdorm_mean)
climat_grow
for (i in 1:nrow(climat_grow)) {
#linear model for comparison
mat <- megamatrix_delay( F_params=F_params,
M_params=M_params,
twosex=F,
grow_perturb=0,
surv_perturb=0,
flow_perturb=0,
fert_perturb=0,
viab_perturb=0,
pptgrow=climat_grow[i,1],
tempgrow=climat_grow[i,2],
pptdorm=climat_grow[i,3],
tempdorm=climat_grow[i,4],
rfx=rfx_fun())$MEGAmat
lambda_grow_mean[i] <- popbio::lambda(mat)
# 2-sex model
lambda_run <- lambdaSim_delay( F_params=F_params,
M_params=M_params,
grow_perturb=0,
surv_perturb=0,
flow_perturb=0,
fert_perturb=0,
viab_perturb=0,
pptgrow=climat_grow[i,1],
tempgrow=climat_grow[i,2],
pptdorm=climat_grow[i,3],
tempdorm=climat_grow[i,4],
rfx = rfx_fun(),
max.yrs = max_yrs)
lambda_grow_mean_2sex[i] <- lambda_run$lambdatracker[max_yrs]
SR_grow_mean[i] <- lambda_run$SRtracker[max_yrs]
OSR_grow_mean[i] <- lambda_run$OSRtracker[max_yrs]
ssd[,i] <- lambda_run$n0
}
climat_grow
nrow(climat_grow)
lambda_grow_mean<-lambda_grow_mean_2sex<-SR_grow_mean<-OSR_grow_mean<-c()
ssd<-matrix(NA,(F_params$max_size+1)*2,nrow(climat_grow))
max_yrs <- 10
for (i in 1:nrow(climat_grow)) {
#linear model for comparison
mat <- megamatrix_delay( F_params=F_params,
M_params=M_params,
twosex=F,
grow_perturb=0,
surv_perturb=0,
flow_perturb=0,
fert_perturb=0,
viab_perturb=0,
pptgrow=climat_grow[i,1],
tempgrow=climat_grow[i,2],
pptdorm=climat_grow[i,3],
tempdorm=climat_grow[i,4],
rfx=rfx_fun())$MEGAmat
lambda_grow_mean[i] <- popbio::lambda(mat)
# 2-sex model
lambda_run <- lambdaSim_delay( F_params=F_params,
M_params=M_params,
grow_perturb=0,
surv_perturb=0,
flow_perturb=0,
fert_perturb=0,
viab_perturb=0,
pptgrow=climat_grow[i,1],
tempgrow=climat_grow[i,2],
pptdorm=climat_grow[i,3],
tempdorm=climat_grow[i,4],
rfx = rfx_fun(),
max.yrs = max_yrs)
lambda_grow_mean_2sex[i] <- lambda_run$lambdatracker[max_yrs]
SR_grow_mean[i] <- lambda_run$SRtracker[max_yrs]
OSR_grow_mean[i] <- lambda_run$OSRtracker[max_yrs]
ssd[,i] <- lambda_run$n0
}
lambda_grow_mean
lambda_grow_mean_2sex
cbPalette <- RColorBrewer::brewer.pal(8, "Dark2")[c(2,1)]
par(mar=c(5,5,1,1))
plot(climat_grow$pptgrow_seq_extend,lambda_grow_mean,type="l",lwd=2,col=cbPalette[1],
xlab="Precipitation growing season",ylab=expression(paste(lambda)),cex.lab=1.5,ylim=c(0,2.7))
lines(climat_grow$pptgrow_seq_extend,lambda_grow_mean_2sex,type="l",lwd=2,col=cbPalette[2])
legend("topright",legend=c("Two-sex","Female-dominant"),lwd=2,col =cbPalette ,bty="n",cex=1.2)
pptgrow_seq_extend <- seq(min(poar.clim_seasonal$pptgrow),max(poar.clim_seasonal$pptgrow),length.out=10)
tempgrow_seq_extend <- seq(min(poar.clim_seasonal$tempgrow),max(poar.clim_seasonal$tempgrow),length.out=10)
pptdorm_seq_extend <- seq(min(poar.clim_seasonal$pptdorm),max(poar.clim_seasonal$pptdorm),length.out=10)
tempdorm_seq_extend <- seq(min(poar.clim_seasonal$tempdorm),max(poar.clim_seasonal$tempdorm),length.out=10)
dormmean<- data.frame(pptdorm_mean=rep(mean(poar.clim_seasonal$pptdorm),length(pptgrow_seq_extend)),tempdorm_mean=rep(mean(poar.clim_seasonal$tempdorm),length(pptgrow_seq_extend)))
dormmean
climat_grow<-data.frame(pptgrow_seq_extend=pptgrow_seq_extend,tempgrow_seq_extend=tempgrow_seq_extend,pptdorm_mean=rep(mean(poar.clim_seasonal$pptdorm),length(pptgrow_seq_extend)),tempdorm_mean=rep(mean(poar.clim_seasonal$tempdorm),length(pptgrow_seq_extend)))
climat_grow
lambda_grow_mean<-lambda_grow_mean_2sex<-SR_grow_mean<-OSR_grow_mean<-c()
ssd<-matrix(NA,(F_params$max_size+1)*2,nrow(climat_grow))
max_yrs <- 10
for (i in 1:nrow(climat_grow)) {
#linear model for comparison
mat <- megamatrix_delay( F_params=F_params,
M_params=M_params,
twosex=F,
grow_perturb=0,
surv_perturb=0,
flow_perturb=0,
fert_perturb=0,
viab_perturb=0,
pptgrow=climat_grow[i,1],
tempgrow=climat_grow[i,2],
pptdorm=climat_grow[i,3],
tempdorm=climat_grow[i,4],
rfx=rfx_fun())$MEGAmat
lambda_grow_mean[i] <- popbio::lambda(mat)
# 2-sex model
lambda_run <- lambdaSim_delay( F_params=F_params,
M_params=M_params,
grow_perturb=0,
surv_perturb=0,
flow_perturb=0,
fert_perturb=0,
viab_perturb=0,
pptgrow=climat_grow[i,1],
tempgrow=climat_grow[i,2],
pptdorm=climat_grow[i,3],
tempdorm=climat_grow[i,4],
rfx = rfx_fun(),
max.yrs = max_yrs)
lambda_grow_mean_2sex[i] <- lambda_run$lambdatracker[max_yrs]
SR_grow_mean[i] <- lambda_run$SRtracker[max_yrs]
OSR_grow_mean[i] <- lambda_run$OSRtracker[max_yrs]
ssd[,i] <- lambda_run$n0
}
climat_grow<-data.frame(pptgrow_seq_extend=pptgrow_seq_extend,tempgrow_seq_extend=rep(mean(poar.clim_seasonal$tempgrow),length(pptgrow_seq_extend)),pptdorm_mean=rep(mean(poar.clim_seasonal$pptdorm),length(pptgrow_seq_extend)),tempdorm_mean=rep(mean(poar.clim_seasonal$tempdorm),length(pptgrow_seq_extend)))
climat_grow
lambda_grow_mean<-lambda_grow_mean_2sex<-SR_grow_mean<-OSR_grow_mean<-c()
ssd<-matrix(NA,(F_params$max_size+1)*2,nrow(climat_grow))
max_yrs <- 10
for (i in 1:nrow(climat_grow)) {
#linear model for comparison
mat <- megamatrix_delay( F_params=F_params,
M_params=M_params,
twosex=F,
grow_perturb=0,
surv_perturb=0,
flow_perturb=0,
fert_perturb=0,
viab_perturb=0,
pptgrow=climat_grow[i,1],
tempgrow=climat_grow[i,2],
pptdorm=climat_grow[i,3],
tempdorm=climat_grow[i,4],
rfx=rfx_fun())$MEGAmat
lambda_grow_mean[i] <- popbio::lambda(mat)
# 2-sex model
lambda_run <- lambdaSim_delay( F_params=F_params,
M_params=M_params,
grow_perturb=0,
surv_perturb=0,
flow_perturb=0,
fert_perturb=0,
viab_perturb=0,
pptgrow=climat_grow[i,1],
tempgrow=climat_grow[i,2],
pptdorm=climat_grow[i,3],
tempdorm=climat_grow[i,4],
rfx = rfx_fun(),
max.yrs = max_yrs)
lambda_grow_mean_2sex[i] <- lambda_run$lambdatracker[max_yrs]
SR_grow_mean[i] <- lambda_run$SRtracker[max_yrs]
OSR_grow_mean[i] <- lambda_run$OSRtracker[max_yrs]
ssd[,i] <- lambda_run$n0
}
lambda_grow_mean
cbPalette <- RColorBrewer::brewer.pal(8, "Dark2")[c(2,1)]
par(mar=c(5,5,1,1))
plot(climat_grow$pptgrow_seq_extend,lambda_grow_mean,type="l",lwd=2,col=cbPalette[1],
xlab="Precipitation growing season",ylab=expression(paste(lambda)),cex.lab=1.5,ylim=c(0,2.7))
lines(climat_grow$pptgrow_seq_extend,lambda_grow_mean_2sex,type="l",lwd=2,col=cbPalette[2])
legend("topright",legend=c("Two-sex","Female-dominant"),lwd=2,col =cbPalette ,bty="n",cex=1.2)
## extend the climatic  to bounds and beyond of observed distribution
## note that length of this vector has a big effect on how fast/slow the following code runs
pptgrow_seq_extend <- seq(min(poar.clim_seasonal$pptgrow),max(poar.clim_seasonal$pptgrow),length.out=10)
tempgrow_seq_extend <- seq(min(poar.clim_seasonal$tempgrow),max(poar.clim_seasonal$tempgrow),length.out=10)
pptdorm_seq_extend <- seq(min(poar.clim_seasonal$pptdorm),max(poar.clim_seasonal$pptdorm),length.out=10)
tempdorm_seq_extend <- seq(min(poar.clim_seasonal$tempdorm),max(poar.clim_seasonal$tempdorm),length.out=10)
# dormmean<- data.frame(pptdorm_mean=rep(mean(poar.clim_seasonal$pptdorm),length(pptgrow_seq_extend)),tempdorm_mean=rep(mean(poar.clim_seasonal$tempdorm),length(pptgrow_seq_extend)))
climat_grow<-expand.grid(pptgrow_seq_extend=pptgrow_seq_extend,tempgrow_seq_extend=tempgrow_seq_extend)
pptdorm_mean<-rep(mean(poar.clim_seasonal$pptdorm),nrow(climat_grow))
tempdorm_mean<-rep(mean(poar.clim_seasonal$tempdorm),nrow(climat_grow))
climat_grow<-data.frame(climat_grow,pptdorm_mean,tempdorm_mean)
# climat_grow<-data.frame(pptgrow_seq_extend=pptgrow_seq_extend,tempgrow_seq_extend=tempgrow_seq_extend,pptdorm_mean=rep(mean(poar.clim_seasonal$pptdorm),length(pptgrow_seq_extend)),tempdorm_mean=rep(mean(poar.clim_seasonal$tempdorm),length(pptgrow_seq_extend)))
# library(usethis)
# usethis::edit_r_environ()
lambda_grow_mean<-lambda_grow_mean_2sex<-SR_grow_mean<-OSR_grow_mean<-c()
ssd<-matrix(NA,(F_params$max_size+1)*2,nrow(climat_grow))
max_yrs <- 10
for (i in 1:nrow(climat_grow)) {
#linear model for comparison
mat <- megamatrix_delay( F_params=F_params,
M_params=M_params,
twosex=F,
grow_perturb=0,
surv_perturb=0,
flow_perturb=0,
fert_perturb=0,
viab_perturb=0,
pptgrow=climat_grow[i,1],
tempgrow=climat_grow[i,2],
pptdorm=climat_grow[i,3],
tempdorm=climat_grow[i,4],
rfx=rfx_fun())$MEGAmat
lambda_grow_mean[i] <- popbio::lambda(mat)
# 2-sex model
lambda_run <- lambdaSim_delay( F_params=F_params,
M_params=M_params,
grow_perturb=0,
surv_perturb=0,
flow_perturb=0,
fert_perturb=0,
viab_perturb=0,
pptgrow=climat_grow[i,1],
tempgrow=climat_grow[i,2],
pptdorm=climat_grow[i,3],
tempdorm=climat_grow[i,4],
rfx = rfx_fun(),
max.yrs = max_yrs)
lambda_grow_mean_2sex[i] <- lambda_run$lambdatracker[max_yrs]
SR_grow_mean[i] <- lambda_run$SRtracker[max_yrs]
OSR_grow_mean[i] <- lambda_run$OSRtracker[max_yrs]
ssd[,i] <- lambda_run$n0
}
library(RColorBrewer)
library(lattice)
cls <- colorRampPalette(rev(brewer.pal(11, 'RdYlBu')))(100)
mtrx_grow <- matrix(lambda_grow_mean, nrow = 10, dimnames = list(pptgrow_seq_extend,
tempgrow_seq_extend))
persp(mtrx_grow,xlab="Precipitation",ylab="Temperature",zlab=expression(paste(lambda)),
theta = 30, phi = 30,col=cls)
lambda_grow_mean
lambda_grow_mean_2sex
trellis.par.set("axis.line",list(col=NA,lty=1,lwd=1))
wireframe(lambda_grow_mean ~ climat_grow$pptgrow_seq_extend + climat_grow$tempgrow_seq_extend,
# subset = lambda_grow_mean < 5,
zlab = list(expression(paste(lambda)), rot=90),
drape = TRUE, col.regions = cls, scales = list(arrows = FALSE),
par.settings = list(axis.line = list(col = 'transparent')),
main='', xlab='Precipitation', ylab='Temperature', screen=list(z = 120, x = -70, y = 3))
# trellis.par.set("axis.line",list(col=NA,lty=1,lwd=1))
wireframe(lambda_grow_mean ~ climat_grow$pptgrow_seq_extend + climat_grow$tempgrow_seq_extend,
# subset = lambda_grow_mean < 5,
zlab = list(expression(paste(lambda)), rot=90),
drape = TRUE, col.regions = cls, scales = list(arrows = FALSE),
par.settings = list(axis.line = list(col = 'transparent')),
main='', xlab='Precipitation', ylab='Temperature', screen=list(z = 120, x = -70, y = 3))
filled.contour(x=tempgrow_seq_extend,y=pptgrow_seq_extend,z=mtrx_grow)
# fields::image.plot(mtrx_grow)
filled.contour(mtrx_grow, plot.axes = {
axis(1)
axis(2)
contour(mtrx_grow, add = TRUE, lwd = 1)
}
)
grow_climate_plot<-data.frame(pptgrow=climat_grow$pptgrow_seq_extend,tempgrow=climat_grow$tempgrow_seq_extend,lambda=lambda_grow_mean)
gg = ggplot(grow_climate_plot, aes(x = pptgrow, y = tempgrow)) +
geom_raster(aes(fill = lambda)) +
geom_contour(aes(z = lambda), colour = "white", size = 0.2, alpha = 0.5) +
metR::geom_text_contour(aes(z = lambda),  colour = "white" ) +
labs(x = "Temperature",
y = "Precipitation",
fill = "Lambda") +
theme(legend.title = element_text(size = 10, face = "bold"),
legend.position = "right", panel.background = element_blank(),
axis.text = element_text(colour = "black", size = 10),
axis.title = element_text(size = 12),
legend.text = element_text(size = 11), legend.key = element_blank()) +
scale_fill_continuous(low = "#BFE1B0", high = "#137177") +
scale_y_continuous(expand = c(0,0)) +
scale_x_continuous(expand = c(0,0))
gg
